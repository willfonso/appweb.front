<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PWA Ventas - Dashboard</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <style>
    :root {
      --bg: #f2f2f7;
      --card: #fff;
      --text: #222;
      --muted: #666;
      --accent: #007aff;
    }
    [data-theme="dark"]{ --bg:#0b0b0b; --card:#111; --text:#eee; --muted:#aaa; --accent:#0a84ff; }
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial; background:var(--bg); color:var(--text); margin:0; padding:16px;}
    h1{text-align:center;margin:8px 0 16px;}
    .card{background:var(--card);border-radius:12px;padding:12px;margin-bottom:12px;box-shadow:0 6px 18px rgba(0,0,0,0.06);}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:8px;}
    .col{flex:1;min-width:120px;}
    label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px;text-transform: uppercase;}
    input, select{width:100%;padding:8px;border-radius:8px;border:1px solid #ddd;font-size:14px;}
    button{padding:10px 14px;background:var(--accent);color:white;border:none;border-radius:8px;cursor:pointer;}
    table{width:100%;border-collapse:collapse;margin-top:8px;}
    th, td{padding:8px 10px;text-align:left;font-size:13px;border-bottom:1px solid rgba(0,0,0,0.04);}
    thead th{background:transparent;color:var(--muted);font-weight:700;}
    tfoot td{font-weight:700;background:transparent}
    #chartWrap{height:220px;margin-top:12px}
    #toggleTheme{position:fixed;right:14px;bottom:14px;border-radius:999px;padding:10px;background:var(--card);box-shadow:0 6px 18px rgba(0,0,0,0.06);border:none}
    @media (max-width:420px){
      th, td{font-size:12px;padding:8px;}
      .row{gap:6px}
    }
  </style>
</head>
<body>
    <button id="btnLogout" style="position:fixed; right:14px; top:14px; padding:8px 12px; background:#b00020; color:white; border:none; border-radius:8px; cursor:pointer; font-size:14px; z-index: 100;">Cerrar Sesi√≥n</button>
  
  <h1>Dashboard de Ventas</h1>


  <div class="card">
    <div class="row">
      <div class="col">
        <label>Desde</label>
        <input type="date" id="desde" />
      </div>
      <div class="col">
        <label>Hasta</label>
        <input type="date" id="hasta" />
      </div>
    </div>
    <div class="row">
      <div class="col">
        <label>Grupo (opcional)</label>
        <input type="text" id="grupo" placeholder="Ej: OBRADORES, MARKET o CRIOLLO" />
      </div>
      <div class="col">
        <label>Punto de Venta</label>
        <select id="pdv"><option value="">-- Todos --</option></select>
      </div>
    </div>

    <div class="row">
      <div style="flex:0 0 160px">
        <button id="btnConsultar">Consultar</button>
      </div>
      <div style="flex:0 0 160px">
        <button id="btnExportExcel">Exportar Excel</button>
      </div>
      <div style="flex:1;text-align:right">
        <span id="status" style="color:var(--muted)"></span>
      </div>
    </div>

  </div>

  <div class="card">
    <div id="error-msg" style="display:none;color:#b00020;padding:6px;text-align:center;"></div>

    <table>
      <thead>
        <tr id="table-head">
          <th>PDV</th>
          <th>ARREGLOS</th>
          <th>EFEC</th>
          <th>MP</th>
          <th>RAPPI</th>
          <th>PYT</th>
          <th>PYE</th>
          <th>TDB</th>
          <th>TDC</th>
          <th>BITCOIN</th>
          <th>DELIVERY</th>
          <th>CTA</th>
          <th>TOTAL</th>
        </tr>
      </thead>
      <tbody id="tabla-ventas-body"></tbody>
      <tfoot id="table-foot"></tfoot>
    </table>
    <h2 style="margin-top: 30px; text-align:center;">Gr√°fico de Ventas</h2>
    <canvas id="grafico" style="margin-top:20px;"></canvas>


  </div>

  <div id="loading" style="display:none;text-align:center;padding:10px;font-weight:700">‚è≥ Cargando...</div>
  
  <button id="toggleTheme">üåì</button>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <script src="script.js"></script>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').then(reg => {
          console.log('SW registrado:', reg.scope);
        }).catch(err => console.warn('SW fall√≥:', err));
      });
    }
  </script>
  
</body>
</html>